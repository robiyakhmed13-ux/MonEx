import{u as D,r as c,g as C,t as v,j as e,a as j,f as M,A,h as T}from"./index-Bngez1jy.js";const S="hamyon_recurring",q=()=>{const{t:i,getCat:m,catLabel:k,addTransaction:n,showToast:u,allCats:w}=D(),[r,p]=c.useState(()=>C.get(S,[])),[N,d]=c.useState(!1),o=c.useCallback(t=>{p(t),C.set(S,t)},[]),b=c.useCallback(t=>{o(r.filter(a=>a.id!==t)),u("âœ“",!0)},[r,o,u]),y=c.useCallback(t=>{o(r.map(a=>a.id===t?{...a,active:!a.active}:a))},[r,o]),g=c.useCallback(async t=>{const a=new Date;await n({type:t.type,amount:t.type==="expense"?-Math.abs(t.amount):Math.abs(t.amount),categoryId:t.categoryId,description:t.description,date:v(),time:a.toISOString().slice(11,16),source:"recurring",recurringId:t.id});const l=new Date(t.nextDate);switch(t.frequency){case"daily":l.setDate(l.getDate()+1);break;case"weekly":l.setDate(l.getDate()+7);break;case"monthly":l.setMonth(l.getMonth()+1);break;case"yearly":l.setFullYear(l.getFullYear()+1);break}o(r.map(h=>h.id===t.id?{...h,nextDate:l.toISOString().slice(0,10)}:h))},[n,r,o]),f=t=>{var l;return((l={daily:{uz:"Kunlik",ru:"Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾",en:"Daily"},weekly:{uz:"Haftalik",ru:"Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ð¾",en:"Weekly"},monthly:{uz:"Oylik",ru:"Ð•Ð¶ÐµÐ¼ÐµÑÑÑ‡Ð½Ð¾",en:"Monthly"},yearly:{uz:"Yillik",ru:"Ð•Ð¶ÐµÐ³Ð¾Ð´Ð½Ð¾",en:"Yearly"}}[t])==null?void 0:l.en)||t},x=c.useMemo(()=>{const t=v();return r.filter(a=>a.active&&a.nextDate<=t)},[r]);return e.jsxs("div",{className:"screen-container pb-32",children:[e.jsx("div",{className:"safe-top px-4 pt-4 pb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-title-1 text-foreground",children:i.recurring||"Recurring"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.subscriptions||"Subscriptions & bills"})]}),e.jsx(j.button,{whileTap:{scale:.95},onClick:()=>d(!0),className:"w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"+"})})]})}),x.length>0&&e.jsx("div",{className:"px-4 mb-4",children:e.jsxs("div",{className:"bg-expense/10 border border-expense/20 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("span",{className:"text-xl",children:"âš ï¸"}),e.jsxs("p",{className:"font-semibold text-foreground",children:[x.length," ",i.dueToday||"due today"]})]}),e.jsx("div",{className:"space-y-2",children:x.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-foreground",children:t.description}),e.jsx("button",{onClick:()=>g(t),className:"px-3 py-1 bg-primary text-primary-foreground text-xs font-medium rounded-full",children:i.execute||"Execute"})]},t.id))})]})}),e.jsx("div",{className:"px-4 space-y-3",children:r.length===0?e.jsxs("div",{className:"card-elevated p-8 text-center",children:[e.jsx("span",{className:"text-5xl block mb-3",children:"ðŸ”„"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:i.noRecurring||"No recurring transactions"}),e.jsx("button",{onClick:()=>d(!0),className:"btn-primary",children:i.add})]}):r.map(t=>{const a=m(t.categoryId);return e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`glass-card p-4 transition-opacity ${t.active?"":"opacity-50"}`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-2xl",style:{backgroundColor:`${a.color}20`},children:t.emoji||a.emoji}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:f(t.frequency)}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[i.next||"Next",": ",t.nextDate]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:`font-bold ${t.type==="expense"?"text-expense":"text-income"}`,children:[t.type==="expense"?"-":"+",M(t.amount)]})})]}),e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-border",children:[e.jsx("button",{onClick:()=>y(t.id),className:`flex-1 py-2 rounded-lg text-sm font-medium ${t.active?"bg-secondary text-foreground":"bg-primary/10 text-primary"}`,children:t.active?i.pause||"Pause":i.resume||"Resume"}),e.jsx("button",{onClick:()=>b(t.id),className:"px-4 py-2 rounded-lg bg-destructive/10 text-destructive text-sm font-medium",children:i.delete})]})]},t.id)})}),e.jsx(R,{isOpen:N,onClose:()=>d(!1),onSave:t=>{o([...r,t]),d(!1)}})]})},R=c.memo(({isOpen:i,onClose:m,onSave:k})=>{const{t:n,allCats:u,getCat:w,catLabel:r}=D(),[p,N]=c.useState("expense"),[d,o]=c.useState(""),[b,y]=c.useState(""),[g,f]=c.useState("bills"),[x,t]=c.useState("monthly"),[a,l]=c.useState(v()),h=p==="expense"?u.expense:u.income,I=()=>{if(!d||!b)return;const s=w(g);k({id:T(),type:p,amount:parseInt(d),description:b,categoryId:g,frequency:x,nextDate:a,active:!0,emoji:s.emoji}),o(""),y("")};return i?e.jsx(A,{children:e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:m,children:e.jsxs(j.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-background rounded-3xl p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"w-12 h-1.5 bg-border rounded-full mx-auto mb-6"}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-title-1 text-foreground",children:n.addRecurring||"Add Recurring"}),e.jsx("button",{onClick:m,className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-muted-foreground hover:bg-muted",children:"âœ•"})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:[{k:"expense",label:n.expense,color:"expense"},{k:"income",label:n.incomeType,color:"income"}].map(s=>e.jsx("button",{onClick:()=>{N(s.k),f(s.k==="expense"?"bills":"salary")},className:`flex-1 py-3 rounded-xl font-semibold transition-all ${p===s.k?s.k==="expense"?"bg-red-50 text-expense border-2 border-expense":"bg-green-50 text-income border-2 border-income":"bg-secondary text-muted-foreground border-2 border-transparent"}`,children:s.label},s.k))}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-caption text-muted-foreground font-medium mb-2 block",children:n.amount}),e.jsx("input",{value:d,onChange:s=>o(s.target.value.replace(/[^\d]/g,"")),type:"text",inputMode:"numeric",className:"input-clean text-2xl font-bold",placeholder:"0"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-caption text-muted-foreground font-medium mb-2 block",children:n.description}),e.jsx("input",{value:b,onChange:s=>y(s.target.value),type:"text",className:"input-clean",placeholder:"e.g. Netflix, Rent..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-caption text-muted-foreground font-medium mb-2 block",children:n.frequency||"Frequency"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["daily","weekly","monthly","yearly"].map(s=>e.jsx("button",{onClick:()=>t(s),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${x===s?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-caption text-muted-foreground font-medium mb-2 block",children:[n.next||"Next"," ",n.date]}),e.jsx("input",{value:a,onChange:s=>l(s.target.value),type:"date",className:"input-clean"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"text-caption text-muted-foreground font-medium mb-3 block",children:n.category}),e.jsx("div",{className:"grid grid-cols-4 gap-2 max-h-32 overflow-y-auto no-scrollbar",children:h.map(s=>e.jsxs("button",{onClick:()=>f(s.id),className:`p-3 rounded-xl flex flex-col items-center gap-1.5 transition-all ${g===s.id?"bg-accent ring-2 ring-primary scale-105":"bg-secondary hover:bg-muted"}`,children:[e.jsx("span",{className:"text-xl",children:s.emoji}),e.jsx("span",{className:"text-2xs text-center truncate w-full text-muted-foreground",children:r(s)})]},s.id))})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"btn-secondary flex-1",children:n.cancel}),e.jsx("button",{onClick:I,className:"btn-primary flex-1",children:n.save})]})]})})}):null});R.displayName="AddRecurringModal";export{q as RecurringScreen,q as default};
