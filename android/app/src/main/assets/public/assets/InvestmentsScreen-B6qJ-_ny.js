import{r as i,u as M,g as b,j as e,a as d,K as A,P as Q,I as R,J as O,z as Y,A as K,X,h as Z,L as H}from"./index-Bngez1jy.js";import{T as W}from"./trash-2-DgMVlkGx.js";const E=[{value:"stock",label:"Stock",emoji:"ðŸ“ˆ"},{value:"crypto",label:"Crypto",emoji:"â‚¿"},{value:"etf",label:"ETF",emoji:"ðŸ“Š"},{value:"mutual_fund",label:"Mutual Fund",emoji:"ðŸ’¼"}],ae=i.memo(()=>{const{lang:s,currency:ee,showToast:P,setActiveScreen:U}=M(),[m,y]=i.useState(()=>b.get("hamyon_investments",[])),[$,u]=i.useState(!1),[f,g]=i.useState(!1),[j,q]=i.useState(null),[x,w]=i.useState(""),[N,S]=i.useState(""),[k,C]=i.useState("stock"),[v,F]=i.useState(""),[p,T]=i.useState(""),o={title:s==="ru"?"Ð˜Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¸":s==="uz"?"Investitsiyalar":"Investments",addNew:s==="ru"?"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ":s==="uz"?"Qo'shish":"Add New",symbol:s==="ru"?"Ð¢Ð¸ÐºÐµÑ€":s==="uz"?"Tiker":"Symbol",name:s==="ru"?"ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ":s==="uz"?"Nomi":"Name",type:s==="ru"?"Ð¢Ð¸Ð¿":s==="uz"?"Turi":"Type",quantity:s==="ru"?"ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾":s==="uz"?"Miqdor":"Quantity",purchasePrice:s==="ru"?"Ð¦ÐµÐ½Ð° Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸":s==="uz"?"Sotib olish narxi":"Purchase Price",currentPrice:s==="ru"?"Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ñ†ÐµÐ½Ð°":s==="uz"?"Joriy narx":"Current Price",totalValue:s==="ru"?"ÐžÐ±Ñ‰Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ":s==="uz"?"Jami qiymat":"Total Value",gain:s==="ru"?"ÐŸÑ€Ð¸Ð±Ñ‹Ð»ÑŒ/Ð£Ð±Ñ‹Ñ‚Ð¾Ðº":s==="uz"?"Foyda/Zarar":"Gain/Loss",refresh:s==="ru"?"ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ†ÐµÐ½Ñ‹":s==="uz"?"Narxlarni yangilash":"Refresh Prices",save:s==="ru"?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ":s==="uz"?"Saqlash":"Save",noInvestments:s==="ru"?"ÐÐµÑ‚ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¹":s==="uz"?"Investitsiyalar yo'q":"No investments",portfolio:s==="ru"?"ÐŸÐ¾Ñ€Ñ‚Ñ„ÐµÐ»ÑŒ":s==="uz"?"Portfel":"Portfolio"},c=i.useMemo(()=>{let t=0,r=0;m.forEach(l=>{const z=(l.currentPrice||l.purchasePrice)*l.quantity,h=l.purchasePrice*l.quantity;t+=z,r+=h});const a=t-r,n=r>0?a/r*100:0;return{totalValue:t,totalCost:r,totalGain:a,totalGainPercent:n}},[m]),I=()=>{w(""),S(""),C("stock"),F(""),T(""),q(null)},D=async(t,r)=>{try{const{data:a,error:n}=await H.functions.invoke("get-stock-price",{body:{symbol:t,type:r==="crypto"?"crypto":"stock"}});if(n)throw n;return(a==null?void 0:a.price)||null}catch(a){return console.error("Failed to fetch price:",a),null}},L=async()=>{g(!0);const t=await Promise.all(m.map(async r=>{const a=await D(r.symbol,r.type);return a?{...r,currentPrice:a}:r}));y(t),b.set("hamyon_investments",t),g(!1),P("âœ“",!0)},V=async()=>{if(!x.trim()||!N.trim()||!v||!p)return;g(!0);const t=await D(x.toUpperCase(),k),r={id:j||Z(),symbol:x.toUpperCase().trim(),name:N.trim(),type:k,quantity:parseFloat(v),purchasePrice:parseFloat(p),purchaseDate:new Date().toISOString().slice(0,10),currentPrice:t||parseFloat(p),currency:"USD"};y(j?a=>{const n=a.map(l=>l.id===j?r:l);return b.set("hamyon_investments",n),n}:a=>{const n=[r,...a];return b.set("hamyon_investments",n),n}),g(!1),P("âœ“",!0),u(!1),I()},_=t=>{y(r=>{const a=r.filter(n=>n.id!==t);return b.set("hamyon_investments",a),a}),P("âœ“",!0)},B=t=>{w(t.symbol),S(t.name),C(t.type),F(t.quantity.toString()),T(t.purchasePrice.toString()),q(t.id),u(!0)};return e.jsxs("div",{className:"min-h-screen bg-background pb-32 px-4 pt-4",children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>U("home"),className:"text-2xl",children:"â†"}),e.jsx("h1",{className:"text-xl font-bold text-foreground",children:o.title})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d.button,{whileTap:{scale:.95},onClick:L,disabled:f||m.length===0,className:"p-2 rounded-full bg-secondary text-foreground disabled:opacity-50",children:e.jsx(A,{className:`w-5 h-5 ${f?"animate-spin":""}`})}),e.jsx(d.button,{whileTap:{scale:.95},onClick:()=>{I(),u(!0)},className:"p-2 rounded-full bg-primary text-primary-foreground",children:e.jsx(Q,{className:"w-5 h-5"})})]})]}),e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"p-6 rounded-3xl bg-gradient-to-br from-primary/30 via-primary/10 to-transparent border border-primary/20 mb-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:o.portfolio}),e.jsxs("div",{className:"flex items-baseline gap-3 mb-4",children:[e.jsxs("h2",{className:"text-3xl font-bold text-foreground",children:["$",c.totalValue.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsxs(d.div,{initial:{scale:0},animate:{scale:1},className:`flex items-center gap-1 px-2 py-1 rounded-full text-sm font-medium ${c.totalGain>=0?"bg-income/20 text-income":"bg-expense/20 text-expense"}`,children:[c.totalGain>=0?e.jsx(R,{className:"w-4 h-4"}):e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[c.totalGainPercent>=0?"+":"",c.totalGainPercent.toFixed(2),"%"]})]})]}),e.jsxs("p",{className:`text-lg font-medium ${c.totalGain>=0?"text-income":"text-expense"}`,children:[c.totalGain>=0?"+":"","$",c.totalGain.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),m.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx("span",{className:"text-4xl block mb-3",children:"ðŸ“Š"}),e.jsx("p",{children:o.noInvestments})]}):e.jsx("div",{className:"space-y-3",children:m.map((t,r)=>{var G;const a=(t.currentPrice||t.purchasePrice)*t.quantity,n=t.purchasePrice*t.quantity,l=a-n,z=n>0?l/n*100:0,h=E.find(J=>J.value===t.type);return e.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.05},className:"p-4 rounded-2xl bg-card border border-border",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:h==null?void 0:h.emoji}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-foreground",children:t.symbol}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t.name})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.quantity," Ã— $",((G=t.currentPrice)==null?void 0:G.toFixed(2))||t.purchasePrice.toFixed(2)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-foreground",children:["$",a.toLocaleString("en-US",{minimumFractionDigits:2})]}),e.jsxs("p",{className:`text-sm font-medium ${l>=0?"text-income":"text-expense"}`,children:[l>=0?"+":"",z.toFixed(2),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 pt-3 border-t border-border",children:[e.jsx("button",{onClick:()=>B(t),className:"p-2 rounded-lg bg-secondary text-foreground",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(t.id),className:"p-2 rounded-lg bg-destructive/20 text-destructive",children:e.jsx(W,{className:"w-4 h-4"})})]})]},t.id)})}),e.jsx(K,{children:$&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50 flex items-end justify-center",onClick:()=>u(!1),children:e.jsxs(d.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},onClick:t=>t.stopPropagation(),className:"bg-background rounded-t-3xl p-6 w-full max-w-lg max-h-[85vh] overflow-y-auto",style:{paddingBottom:"calc(1.5rem + 80px + env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",children:j?o.save:o.addNew}),e.jsx("button",{onClick:()=>u(!1),className:"p-2",children:e.jsx(X,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:o.type}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:E.map(t=>e.jsxs("button",{onClick:()=>C(t.value),className:`p-3 rounded-xl flex items-center gap-2 ${k===t.value?"bg-primary text-primary-foreground":"bg-secondary"}`,children:[e.jsx("span",{children:t.emoji}),e.jsx("span",{className:"text-sm font-medium",children:t.label})]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:o.symbol}),e.jsx("input",{type:"text",value:x,onChange:t=>w(t.target.value.toUpperCase()),placeholder:"AAPL, BTC, SPY...",className:"w-full p-3 rounded-xl bg-secondary border border-border text-foreground uppercase"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:o.name}),e.jsx("input",{type:"text",value:N,onChange:t=>S(t.target.value),placeholder:"Apple Inc., Bitcoin...",className:"w-full p-3 rounded-xl bg-secondary border border-border text-foreground"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:o.quantity}),e.jsx("input",{type:"number",step:"any",value:v,onChange:t=>F(t.target.value),placeholder:"0",className:"w-full p-3 rounded-xl bg-secondary border border-border text-foreground"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground mb-2",children:[o.purchasePrice," (USD)"]}),e.jsx("input",{type:"number",step:"any",value:p,onChange:t=>T(t.target.value),placeholder:"0.00",className:"w-full p-3 rounded-xl bg-secondary border border-border text-foreground"})]}),e.jsxs(d.button,{whileTap:{scale:.98},onClick:V,disabled:!x.trim()||!N.trim()||!v||!p||f,className:"w-full p-4 rounded-xl bg-primary text-primary-foreground font-bold disabled:opacity-50 flex items-center justify-center gap-2",children:[f&&e.jsx(A,{className:"w-4 h-4 animate-spin"}),o.save]})]})]})})})]})});export{ae as InvestmentsScreen,ae as default};
